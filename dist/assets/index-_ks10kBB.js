import{n as y,q as c,o as H,y as $,al as S,z as C,h as n,x as l,C as p,an as J,am as L,az as j,aB as k,H as G,I as Q,F as W,aJ as X,K as Y,aK as Z}from"./index-2Jd8rWh6.js";import{_ as ee}from"./index-3AhFV0QK.js";import{_ as ae}from"./index-y8_R3JUU.js";import{_ as ne}from"./index-m9RUEidI.js";import"./index-xwjqNcDb.js";import"./Checkbox-HHssC9AZ.js";import"./index-J_zEoqFC.js";import"./index-Xoa9F3yp.js";function te(){return y({url:"/sys/permission",method:"get"})}function z(i){return y({url:"/sys/permission",method:"post",data:i})}function le(i){return y({url:`/sys/permission/${i}`,method:"delete"})}function se(i){return y({url:`/sys/permission/${i}`,method:"get"})}function oe(i,P){return y({url:`/sys/permission/${i}`,method:"put",data:P})}const ie={class:"bg-white p-2"},ue={class:"font-bold"},ye={__name:"index",setup(i){const P=[{title:"名称",key:"name",dataIndex:"name"},{title:"标识",key:"code",dataIndex:"code"},{title:"描述",key:"description",dataIndex:"description"},{title:"操作",key:"action",dataIndex:"action",width:180}],x=c(!1),I=c([]);H(()=>{f()});const f=async()=>{x.value=!0;const s=await te();I.value=A(s),x.value=!1},A=s=>{const a={};s.forEach(t=>a[t.id]={...t,children:[]});const u=[];s.forEach(t=>{const r=a[t.pid];r?r.children.push(a[t.id]):u.push(a[t.id])});function g(t){t.children.length===0?t.children=null:t.children.forEach(r=>g(r))}return u.forEach(t=>g(t)),u},m=c(!1),d=c(!1),v=c(""),V=c(null),e=c({name:"",code:"",description:"",enVisible:!1,pid:"",type:""}),E={name:{required:!0,message:"请输入权限名称",trigger:"blur"},code:{required:!0,message:"请输入权限标识",trigger:"blur"}},U=async()=>{d.value=!0,e.value.type=1,e.value.pid=0,e.value.enVisible=e.value.enVisible?"1":"0",await z(e.value),d.value=!1,k.success("添加成功!"),b(),m.value=!1,f()},F=async s=>{await le(s.id),k.success("删除成功!"),f()},N=async s=>{const a=await se(s.id);e.value={...a,enVisible:a.enVisible==="1"},w("update")},q=async()=>{d.value=!0,await oe(e.value.id,e.value),d.value=!1,k.success("更新成功!"),b(),m.value=!1,f()},K=async()=>{d.value=!0,e.value.enVisible=e.value.enVisible?"1":"0",await z(e.value),d.value=!1,k.success("添加成功!"),b(),m.value=!1,f()},w=async(s,a)=>{v.value=s,s==="addSub"&&(e.value.type=2,e.value.pid=a.id),m.value=!0},M=()=>{V.value.validate().then(()=>{v.value==="add"&&U(),v.value==="update"&&q(),v.value==="addSub"&&K()})},b=()=>{V.value.resetFields(),e.value={name:"",code:"",description:"",enVisible:!1}};return(s,a)=>{const u=G,g=ee,t=ae,r=Q,h=W,O=X,R=ne,T=Y,D=Z;return $(),S("div",null,[C("div",ie,[n(u,{type:"primary",class:"mb-2",onClick:a[0]||(a[0]=o=>w("add"))},{default:l(()=>[p("添加权限")]),_:1}),n(t,{columns:P,"data-source":I.value,pagination:!1,loading:x.value,rowKey:"id"},{bodyCell:l(({column:o,record:_})=>[o.key==="action"?($(),S(J,{key:0},[n(u,{type:"link",size:"small",onClick:B=>N(_)},{default:l(()=>[p("编辑")]),_:2},1032,["onClick"]),n(u,{type:"link",size:"small",disabled:_.type===2,onClick:B=>w("addSub",_)},{default:l(()=>[p("添加")]),_:2},1032,["disabled","onClick"]),n(g,{placement:"bottom","ok-text":"删除","cancel-text":"取消",onConfirm:B=>F(_)},{title:l(()=>[C("div",null,[p("确定要删除 "),C("span",ue,L(_.name),1),p(" 吗?")])]),default:l(()=>[n(u,{type:"link",size:"small"},{default:l(()=>[p("删除")]),_:1})]),_:2},1032,["onConfirm"])],64)):j("",!0)]),_:1},8,["data-source","loading"])]),n(D,{open:m.value,"onUpdate:open":a[5]||(a[5]=o=>m.value=o),title:v.value==="add"?"添加权限点":"编辑权限点",onOk:M,onCancel:b,destroyOnClose:!0,"confirm-loading":d.value},{default:l(()=>[n(T,{ref_key:"formRef",ref:V,model:e.value,rules:E,"label-col":{style:{width:"80px"}}},{default:l(()=>[n(h,{label:"权限名称",name:"name","has-feedback":""},{default:l(()=>[n(r,{value:e.value.name,"onUpdate:value":a[1]||(a[1]=o=>e.value.name=o),placeholder:"请输入权限名称"},null,8,["value"])]),_:1}),n(h,{label:"权限标识",name:"code","has-feedback":""},{default:l(()=>[n(r,{value:e.value.code,"onUpdate:value":a[2]||(a[2]=o=>e.value.code=o),placeholder:"请输入权限标识"},null,8,["value"])]),_:1}),n(h,{label:"权限描述",name:"description","has-feedback":""},{default:l(()=>[n(O,{value:e.value.description,"onUpdate:value":a[3]||(a[3]=o=>e.value.description=o),placeholder:"请输入权限描述","show-count":"",maxlength:100,rows:3},null,8,["value"])]),_:1}),n(h,{label:"权限开关",name:"enVisible"},{default:l(()=>[n(R,{checked:e.value.enVisible,"onUpdate:checked":a[4]||(a[4]=o=>e.value.enVisible=o)},null,8,["checked"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title","confirm-loading"])])}}};export{ye as default};
