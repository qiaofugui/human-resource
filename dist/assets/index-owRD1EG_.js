import{ai as be,q as s,o as F,ax as we,b5 as he,aB as w,y as i,al as _,z as k,h as n,x as l,v as N,C as p,am as P,az as S,A as Ie,an as z,ao as xe,b6 as Ee,b7 as Ce,b8 as Oe,b9 as Ne,ba as Pe,bb as Se,bc as ze,ad as Ae,H as Re,bd as Ue,aq as $e,aP as De,L as Fe,O as Te,F as Be,aJ as Le,K as Ve,aK as qe}from"./index-en2k_Z5T.js";import{_ as Ke}from"./index-T-LlMdsa.js";import{_ as Me}from"./index-2bFxf6Zr.js";import{_ as je}from"./index-iMYddFAn.js";import{_ as He}from"./index-LpmhsF80.js";import{_ as Je}from"./index-9d1aJ3sa.js";import{a as Ge}from"./index-Dqp82J3T.js";import"./Checkbox-kJ3Q6jzk.js";const Qe={class:"flex w-full bg-white"},We={class:"left p-2"},Xe={class:"right p-2"},Ye={key:0},Ze={key:1},et={class:"font-bold"},tt={class:"flex justify-end p-2"},at={__name:"index",setup(nt){const J={title:"name",children:"children",key:"id"},f=s([]);F(()=>{G()});let A=s(!1);const G=async()=>{A.value=!0;const a=await we();f.value=Q(a),A.value=!1},Q=a=>{let e=Object.create(null),u=[];return a.forEach(o=>e[o.id]={...o,children:[]}),a.forEach(o=>{let c=e[o.pid];c?c.children.push(e[o.id]):u.push(e[o.id])}),u},W=[{title:"头像",dataIndex:"staffPhoto",key:"staffPhoto",width:80},{title:"姓名",dataIndex:"username",key:"username",width:120},{title:"手机号",dataIndex:"mobile",key:"mobile",width:120},{title:"工号",dataIndex:"workNumber",key:"workNumber",width:120,sorter:(a,e)=>a.workNumber.slice(5)-e.workNumber.slice(5)},{title:"聘用形式",dataIndex:"formOfEmployment",key:"formOfEmployment",width:120},{title:"部门",dataIndex:"departmentName",key:"departmentName"},{title:"入职时间",dataIndex:"timeOfEntry",key:"timeOfEntry",width:120,sorter:(a,e)=>{const u=a.timeOfEntry.replace(/-/g,""),o=e.timeOfEntry.replace(/-/g,"");return u-o}},{title:"操作",key:"action",width:166,fixed:"right"}],d=s({keyword:"",page:1,pagesize:10,departmentId:1}),T=s([]),B=s(0),h=s(!1);F(()=>{v()});const v=async(a,e)=>{var u;try{h.value=!0,d.value.departmentId=((u=e==null?void 0:e.node)==null?void 0:u.id)||1;const o=await he(d.value);T.value=o.rows,B.value=o.total,h.value=!1}catch(o){console.log(o),w.warning("接口异常!"),h.value=!1}},m=s([]),X={onChange:(a,e)=>{m.value=e}},Y=(a,e)=>{d.page=a,d.pagesize=e,v()},Z=[{label:"通知消息",value:1},{label:"提示消息",value:2},{label:"重要消息",value:3},{label:"紧急消息",value:4}],I=s(!1),R=s(!1),x=s(null),ee=()=>{if(m.value.length===0)return w.warning("请先选择通知员工!");I.value=!0},y=s({content:"",type:1,userIds:[]}),te={content:[{required:!0,message:"消息内容不能为空",trigger:"blur"}],type:[{required:!0,message:"消息等级不能为空",trigger:"blur"}]},ae=a=>{m.value=m.value.filter(e=>e.id!==a)},ne=()=>{x.value.validate().then(async()=>{R.value=!0,await Ce({...y.value,userIds:m.value.map(a=>a.id)}),w.success("通知发送成功!"),x.value.resetFields(),R.value=!1,I.value=!1})},oe=async a=>{await Oe(a.id),w.success("删除员工成功!"),v()},U=s(""),E=s(!1),g=s({username:"",workNumber:"",mobile:"",departmentId:null,formOfEmployment:1,timeOfEntry:"",correctionTime:"",staffPhoto:""}),L=async(a,e)=>{U.value=a,a==="update"&&await V(e.id),E.value=!0},V=async a=>{const e=await Ne(a);let u=q(f.value,e.departmentId);g.value={...e,departmentId:u}},q=(a,e,u=[])=>{for(const o of a){if(o.id===e)return[...u,o.id];if(o.children&&o.children.length){const c=q(o.children,e,[...u,o.id]);if(c)return c}}return null},le=()=>{E.value=!1,g.value={username:"",workNumber:"",mobile:"",departmentId:null,formOfEmployment:1,timeOfEntry:"",correctionTime:"",staffPhoto:""}},K=s([]),C=s([]),O=s(!1),$=s(!1),se=async()=>{const a=await Pe();K.value=a.map(e=>({label:e.name,value:e.id}))};F(()=>{se()});const ue=async a=>{await V(a.id),C.value=g.value.roleIds,O.value=!0},re=async()=>{$.value=!0,await Se({id:g.value.id,roleIds:C.value}),w.success("更新角色成功!"),O.value=!1,$.value=!1};return(a,e)=>{const u=ze,o=je,c=Ae,b=Re,ie=Ue,de=Ke,M=$e,pe=He,ce=Je,me=Ge,_e=De,fe=Fe,ve=Te,j=Be,ye=Le,ge=Ve,H=qe,ke=Me;return i(),_("div",null,[k("div",Qe,[k("div",We,[n(c,{spinning:Ie(A)},{default:l(()=>[n(u,{value:d.value.keyword,"onUpdate:value":e[0]||(e[0]=t=>d.value.keyword=t),placeholder:"输入员工姓名搜索","enter-button":"",onSearch:v,class:"mb-2"},null,8,["value"]),f.value.length?(i(),N(o,{key:0,autoExpandParent:!0,"tree-data":f.value,"field-names":J,defaultExpandAll:!0,"block-node":"",onSelect:v},{title:l(({id:t,name:r,managerName:D,code:ot,introduce:lt,managerId:st,pid:ut,createTime:rt})=>[p(P(r),1)]),_:1},8,["tree-data"])):S("",!0)]),_:1},8,["spinning"])]),k("div",Xe,[n(c,{spinning:h.value},{default:l(()=>[n(de,{class:"mb-2"},{default:l(()=>[n(b,{onClick:ee},{default:l(()=>[p("群发通知")]),_:1}),n(b,{type:"primary",onClick:e[1]||(e[1]=t=>L("add"))},{default:l(()=>[n(ie),p(" 添加员工 ")]),_:1})]),_:1}),n(ce,{"row-selection":X,columns:W,"data-source":T.value,scroll:{x:1100},pagination:!1,rowKey:"id"},{bodyCell:l(({column:t,record:r})=>[t.key==="staffPhoto"?(i(),_(z,{key:0},[r.staffPhoto?(i(),N(M,{key:0,class:"my-avatar",src:r.staffPhoto},null,8,["src"])):(i(),N(M,{key:1,class:"my-avatar"},{default:l(()=>[p(P(r.username.charAt(0)),1)]),_:2},1024))],64)):S("",!0),t.key==="formOfEmployment"?(i(),_(z,{key:1},[r.formOfEmployment===1?(i(),_("span",Ye,"正式")):(i(),_("span",Ze,"非正式"))],64)):S("",!0),t.key==="action"?(i(),_(z,{key:2},[n(b,{type:"link",size:"small",onClick:D=>L("update",r)},{default:l(()=>[p("编辑")]),_:2},1032,["onClick"]),n(b,{type:"link",size:"small",onClick:D=>ue(r)},{default:l(()=>[p("角色")]),_:2},1032,["onClick"]),n(pe,{placement:"bottom","ok-text":"删除","cancel-text":"取消",onConfirm:D=>oe(r)},{title:l(()=>[k("div",null,[p("确定要删除 "),k("span",et,P(r.username),1),p(" 吗?")])]),default:l(()=>[n(b,{type:"link",size:"small"},{default:l(()=>[p("删除")]),_:1})]),_:2},1032,["onConfirm"])],64)):S("",!0)]),_:1},8,["data-source"]),k("div",tt,[n(me,{current:d.value.page,"onUpdate:current":e[2]||(e[2]=t=>d.value.page=t),"page-size":d.value.pagesize,"onUpdate:pageSize":e[3]||(e[3]=t=>d.value.pagesize=t),"show-quick-jumper":"",total:B.value,"show-total":t=>`共 ${t} 条`,onChange:Y},null,8,["current","page-size","total","show-total"])])]),_:1},8,["spinning"])])]),n(H,{open:I.value,"onUpdate:open":e[6]||(e[6]=t=>I.value=t),title:"群发通知",onOk:ne,onCancel:e[7]||(e[7]=t=>x.value.resetFields()),destroyOnClose:!0,"confirm-loading":R.value},{default:l(()=>[n(fe,{class:"mb-2"},{default:l(()=>[(i(!0),_(z,null,xe(m.value,t=>(i(),N(_e,{class:"mb-2",closable:m.value.length!==1,onClose:r=>ae(t.id),color:"purple",key:t.id},{default:l(()=>[p("@"+P(t.username),1)]),_:2},1032,["closable","onClose"]))),128))]),_:1}),n(ge,{ref_key:"sendFormRef",ref:x,model:y.value,rules:te},{default:l(()=>[n(j,{label:"消息等级",name:"type","has-feedback":""},{default:l(()=>[n(ve,{value:y.value.type,"onUpdate:value":e[4]||(e[4]=t=>y.value.type=t),options:Z},null,8,["value"])]),_:1}),n(j,{label:"通知内容",name:"content","has-feedback":""},{default:l(()=>[n(ye,{value:y.value.content,"onUpdate:value":e[5]||(e[5]=t=>y.value.content=t),placeholder:"请输入通知内容","show-count":"",maxlength:100,rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"]),n(Ee,{treeData:f.value,"onUpdate:treeData":e[8]||(e[8]=t=>f.value=t),type:U.value,"onUpdate:type":e[9]||(e[9]=t=>U.value=t),open:E.value,"onUpdate:open":e[10]||(e[10]=t=>E.value=t),formState:g.value,"onUpdate:formState":e[11]||(e[11]=t=>g.value=t),onOnSelect:v,onCancel:le},null,8,["treeData","type","open","formState"]),n(H,{open:O.value,"onUpdate:open":e[13]||(e[13]=t=>O.value=t),title:"分配角色",onOk:re,destroyOnClose:!0,"confirm-loading":$.value},{default:l(()=>[n(ke,{value:C.value,"onUpdate:value":e[12]||(e[12]=t=>C.value=t),options:K.value},null,8,["value","options"])]),_:1},8,["open","confirm-loading"])])}}},yt=be(at,[["__scopeId","data-v-e85aaed7"]]);export{yt as default};
