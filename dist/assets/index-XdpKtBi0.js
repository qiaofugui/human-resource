import{n as g,o as le,q as i,y as d,al as u,z,h as n,x as l,A as m,B as o,am as b,az as O,an as C,ap as V,v as ie,aB as P,bc as de,H as ue,I as ce,ad as re,F as pe,aI as me,K as _e,aJ as fe}from"./index-TwhPk9NU.js";import{_ as ke}from"./index-IxPucbfN.js";import{_ as ye}from"./index-ydpq3ULG.js";import{_ as ve}from"./index-umg4-B7O.js";import{a as ge}from"./index-EbxQddqb.js";import{_ as he}from"./index-CgjrgbsS.js";import"./index-jRt2O7V0.js";import"./Checkbox-m_Qp4csq.js";function be(c){return g({url:"/sys/role",params:c})}function we(c){return g({url:"/sys/role",method:"post",data:c})}function xe(c,U){return g({url:`/sys/role/${U}`,method:"put",data:c})}function Ce(c){return g({url:`/sys/role/${c}`,method:"delete"})}function Ie(){return g({url:"/sys/permission"})}function Re(c){return g({url:`/sys/role/${c}`})}function ze(c){return g({url:"/sys/role/assignPrem",method:"put",data:c})}const Pe={class:"bg-white p-2 h-full"},Ue={key:0},Ae={key:1},Ee={key:0},$e={key:1},Be={key:0},Fe={key:1},Se={key:0},Oe={class:"font-bold"},Ve={key:1},qe={class:"flex justify-end p-2"},Je={__name:"index",setup(c){const U=[{name:"ID",dataIndex:"id",key:"id",width:60},{title:"角色",dataIndex:"name",key:"name",width:200},{title:"状态",dataIndex:"state",key:"state",width:100},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"操作",key:"action",width:240}];le(()=>{w(),Q()});const A=i(!1),k=i({page:1,pagesize:10}),q=i([]),K=i(0),w=async()=>{A.value=!0;const a=await be(k.value);q.value=a.rows.map(e=>({...e,state:e.state===1,isEdit:!1})),K.value=a.total,A.value=!1},M=(a,e)=>{k.page=a,k.pagesize=e,w()},x=i(!1),E=i(null),I=i(!1),p=i({name:"",state:0,description:""}),T={name:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],state:[{required:!0,message:"",trigger:"blur"}],description:[{required:!0,message:"角色描述不能为空",trigger:"blur"}]},j=()=>{p.value={name:"",state:0,description:""},x.value=!0},H=()=>{E.value.validate().then(async()=>{try{I.value=!0;const a=await we({...p.value,state:p.value.state?1:0});P.success("角色添加成功!"),I.value=!1,w(),x.value=!1}catch{I.value=!1}})},L=async a=>{await xe({...a,state:a.state?1:0},a.id),P.success("角色更新成功!"),w()},J=async a=>{await Ce(a.id),P.success("角色删除成功!"),w()},G={title:"name",children:"children",key:"id"},$=i([]);i([]);const Q=async()=>{const a=await Ie();$.value=W(a)},W=a=>{let e=[],_={};return a.forEach(r=>{let y=r.id,v=r.pid;_[y]=_[y]||[],r.children=_[y],v===0?e.push(r):(_[v]=_[v]||[],_[v].push(r))}),e},R=i(!1),B=i(!1),h=i([]),X=i(null),F=i(""),N=async a=>{F.value=a.id;const e=await Re(a.id);h.value=e.permIds,R.value=!0},Y=async()=>{B.value=!0;let a={id:F.value,permIds:h.value.checked||h.value};await ze(a),P.success("角色权限更新成功!"),N({id:F.value}),B.value=!1};return(a,e)=>{const _=de,r=ue,y=ce,v=ke,Z=ye,ee=ve,te=ge,ne=re,S=pe,ae=me,se=_e,D=fe,oe=he;return d(),u(b,null,[z("div",Pe,[n(ne,{spinning:o(A)},{default:l(()=>[n(r,{type:"primary",onClick:j,class:"mb-2"},{default:l(()=>[n(_),m(" 添加角色 ")]),_:1}),n(ee,{columns:U,"data-source":o(q),pagination:!1,"row-class-name":(t,s)=>s%2===1?"table-striped":null},{headerCell:l(({column:t})=>[t.key==="id"?(d(),u(b,{key:0},[m(" ID ")],64)):O("",!0)]),bodyCell:l(({column:t,record:s})=>[t.key==="name"?(d(),u(b,{key:0},[s.isEdit?(d(),u("div",Ue,[n(y,{value:s.name,"onUpdate:value":f=>s.name=f,placeholder:"请输入角色名称",size:"small"},null,8,["value","onUpdate:value"])])):(d(),u("div",Ae,C(s.name),1))],64)):t.key==="state"?(d(),u(b,{key:1},[s.isEdit?(d(),u("div",Ee,[n(v,{checked:s.state,"onUpdate:checked":f=>s.state=f},null,8,["checked","onUpdate:checked"])])):(d(),u("div",$e,C(s.state?"已启用":"未启用"),1))],64)):t.key==="description"?(d(),u(b,{key:2},[s.isEdit?(d(),u("div",Be,[n(y,{value:s.description,"onUpdate:value":f=>s.description=f,placeholder:"请输入角色描述","show-count":"",maxlength:100,rows:1,size:"small"},null,8,["value","onUpdate:value"])])):(d(),u("div",Fe,C(s.description),1))],64)):t.key==="action"?(d(),u(b,{key:3},[s.isEdit?(d(),u("div",Ve,[n(r,{type:"link",size:"small",onClick:f=>L(s)},{default:l(()=>[m("完成")]),_:2},1032,["onClick"]),n(r,{type:"link",size:"small",onClick:()=>s.isEdit=!1},{default:l(()=>[m("取消")]),_:2},1032,["onClick"])])):(d(),u("div",Se,[n(r,{type:"link",size:"small",onClick:f=>N(s)},{default:l(()=>[m("分配权限")]),_:2},1032,["onClick"]),n(r,{type:"link",size:"small",onClick:()=>s.isEdit=!0},{default:l(()=>[m("编辑")]),_:2},1032,["onClick"]),n(Z,{placement:"bottom","ok-text":"删除","cancel-text":"取消",onConfirm:f=>J(s)},{title:l(()=>[z("div",null,[m("确定要删除 "),z("span",Oe,C(s.name),1),m(" 吗?")])]),default:l(()=>[n(r,{type:"link",size:"small"},{default:l(()=>[m("删除")]),_:1})]),_:2},1032,["onConfirm"])]))],64)):O("",!0)]),_:1},8,["data-source","row-class-name"]),z("div",qe,[n(te,{current:o(k).page,"onUpdate:current":e[0]||(e[0]=t=>o(k).page=t),"page-size":o(k).pageSize,"onUpdate:pageSize":e[1]||(e[1]=t=>o(k).pageSize=t),"show-quick-jumper":"",total:o(K),"show-total":t=>`共 ${t} 条`,onChange:M},null,8,["current","page-size","total","show-total"])])]),_:1},8,["spinning"])]),n(D,{open:o(x),"onUpdate:open":e[5]||(e[5]=t=>V(x)?x.value=t:null),title:"添加角色",onOk:H,onCancel:e[6]||(e[6]=t=>o(E).resetFields()),destroyOnClose:!0,"confirm-loading":o(I)},{default:l(()=>[n(se,{ref_key:"addFormRef",ref:E,model:o(p),rules:T,"label-col":{style:{width:"100px"}}},{default:l(()=>[n(S,{label:"角色名称",name:"name","has-feedback":""},{default:l(()=>[n(y,{value:o(p).name,"onUpdate:value":e[2]||(e[2]=t=>o(p).name=t),placeholder:"请输入角色名称"},null,8,["value"])]),_:1}),n(S,{label:"启用状态",name:"state","has-feedback":""},{default:l(()=>[n(v,{checked:o(p).state,"onUpdate:checked":e[3]||(e[3]=t=>o(p).state=t)},null,8,["checked"])]),_:1}),n(S,{label:"角色描述",name:"description","has-feedback":""},{default:l(()=>[n(ae,{value:o(p).description,"onUpdate:value":e[4]||(e[4]=t=>o(p).description=t),placeholder:"请输入角色描述","show-count":"",maxlength:100,rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"]),n(D,{open:o(R),"onUpdate:open":e[8]||(e[8]=t=>V(R)?R.value=t:null),title:"分配权限",onOk:Y,destroyOnClose:!0,"confirm-loading":o(B)},{default:l(()=>[o($).length?(d(),ie(oe,{key:0,checkedKeys:o(h),"onUpdate:checkedKeys":e[7]||(e[7]=t=>V(h)?h.value=t:null),checkable:"",autoExpandParent:"",checkStrictly:"","tree-data":o($),"field-names":G,ref_key:"treeRef",ref:X,defaultExpandAll:""},{title:l(({name:t,id:s})=>[m(C(t),1)]),_:1},8,["checkedKeys","tree-data"])):O("",!0)]),_:1},8,["open","confirm-loading"])],64)}}};export{Je as default};
