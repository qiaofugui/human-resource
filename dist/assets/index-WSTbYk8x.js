import{ai as ne,q as i,o as le,ax as se,ay as oe,y as D,al as N,z as _,h as a,x as e,B as s,v as U,A as u,an as I,az as ue,am as S,ao as de,ap as re,aA as ce,aB as O,aC as ie,aD as _e,H as pe,aE as me,J as fe,aF as ve,aG as ge,ad as ke,I as xe,F as be,aH as he,O as ye,aI as Ce,K as we,aJ as De}from"./index-TwhPk9NU.js";import{_ as Ie}from"./index-ydpq3ULG.js";import{D as $e,_ as Ae}from"./index-CgjrgbsS.js";const Be={class:"bg-white p-5"},Ee={class:"flex justify-between items-center"},Le={class:"mr-2"},Oe={class:"flex items-center text-sm"},Pe={class:"mr-2"},qe={class:"popover flex flex-col"},Fe={class:"font-bold"},Ne={__name:"index",setup(Ue){const V={title:"name",children:"children",key:"id"},$=i([]);le(()=>{h(),R()});let A=i(!1);const h=async()=>{A.value=!0;const n=await se();$.value=H(n),A.value=!1},H=n=>{let t=Object.create(null),p=[];return n.forEach(r=>t[r.id]={...r,children:[]}),n.forEach(r=>{let C=t[r.pid];C?C.children.push(t[r.id]):p.push(t[r.id])}),p},d=i(!1),x=i(!1),B=i("add"),y=i(null),o=i({name:"",code:"",managerId:null,introduce:"",pid:""}),M={name:[{required:!0,message:"部门名称不能为空",trigger:"blur"},{min:2,max:10,message:"部门名称的长度为2-10个字符",trigger:"blur"}],code:[{required:!0,message:"部门编码不能为空",trigger:"blur"},{min:2,max:10,message:"部门编码的长度为2-10个字符",trigger:"blur"}],managerId:[{required:!0,message:"部门负责人不能为空",trigger:"blur"}],introduce:[{required:!0,message:"部门介绍不能为空",trigger:"blur"},{min:1,max:100,message:"部门介绍的长度为1-100个字符",trigger:"blur"}]},P=i([]),R=async()=>{const n=await oe();P.value=n},m=(n,t)=>{switch(B.value=n,n){case"add":o.value={name:"",code:"",managerId:null,introduce:"",pid:t.pid},d.value=!0;break;case"update":o.value={...o.value,...t},d.value=!0;break;case"delete":o.value={...o.value,id:t.id},q(n);break}},q=n=>{switch(n){case"add":j(o.value);break;case"update":z(o.value);break;case"delete":J(o.value.id);break}},j=n=>{y.value.validate().then(async()=>{x.value=!0,await ce(n),O.success("部门添加成功!"),x.value=!1,h(),d.value=!1})},z=async n=>{y.value.validate().then(async()=>{x.value=!0,await ie(n,n.id),O.success("部门更新成功!"),x.value=!1,h(),d.value=!1})},J=async n=>{await _e(n),O.success("部门删除成功!"),h(),d.value=!1};return(n,t)=>{const p=pe,r=Ie,C=me,G=fe,E=ve,Q=ge,W=$e,X=Ae,Y=ke,F=xe,w=be,Z=he,T=ye,K=Ce,ee=we,te=De;return D(),N(S,null,[_("div",Be,[a(Y,{spinning:s(A)},{default:e(()=>[s($).length?(D(),U(X,{key:0,autoExpandParent:!0,"tree-data":s($),"block-node":"","field-names":V,defaultExpandAll:!0},{title:e(({id:l,name:c,managerName:ae,code:f,introduce:v,managerId:g,pid:k,createTime:L})=>[a(W,{trigger:["contextmenu"]},{overlay:e(()=>[a(Q,null,{default:e(()=>[a(E,{class:"text-center",key:"add",onClick:b=>m("add",{name:c,code:f,managerId:g,introduce:v,pid:k,createTime:L})},{default:e(()=>[u("添加子部门")]),_:2},1032,["onClick"]),a(E,{class:"text-center",key:"update",onClick:b=>m("update",{name:c,code:f,managerId:g,introduce:v,pid:k,createTime:L,id:l})},{default:e(()=>[u("编辑部门")]),_:2},1032,["onClick"]),a(E,{class:"text-center",key:"delete",onClick:b=>m("delete",{name:c,code:f,managerId:g,introduce:v,pid:k,id:l})},{default:e(()=>[u("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),default:e(()=>[_("div",Ee,[_("div",Le,I(c),1),_("div",Oe,[_("div",Pe,I(ae),1),a(G,{trigger:"hover",placement:"bottom"},{content:e(()=>[_("div",qe,[a(p,{type:"text",class:"item",onClick:b=>m("add",{name:c,code:f,managerId:g,introduce:v,pid:k})},{default:e(()=>[u("添加子部门")]),_:2},1032,["onClick"]),a(p,{type:"text",class:"item",onClick:b=>m("update",{name:c,code:f,managerId:g,introduce:v,pid:k,createTime:L,id:l})},{default:e(()=>[u("编辑部门")]),_:2},1032,["onClick"]),a(r,{placement:"left","ok-text":"删除","cancel-text":"取消",onConfirm:b=>m("delete",{name:c,code:f,managerId:g,introduce:v,pid:k,id:l})},{title:e(()=>[_("div",null,[u("确定要删除 "),_("span",Fe,I(c),1),u(" 吗?")])]),default:e(()=>[a(p,{type:"text",class:"item"},{default:e(()=>[u("删除")]),_:1})]),_:2},1032,["onConfirm"])])]),default:e(()=>[a(p,{type:"link"},{default:e(()=>[u("操作 "),a(C,{class:"text-xs"})]),_:1})]),_:2},1024)])])]),_:2},1024)]),_:1},8,["tree-data"])):ue("",!0)]),_:1},8,["spinning"])]),a(te,{open:s(d),"onUpdate:open":t[4]||(t[4]=l=>re(d)?d.value=l:null),title:s(B)==="add"?"添加部门":"编辑部门",onOk:t[5]||(t[5]=l=>q(s(B),s(o))),onCancel:t[6]||(t[6]=l=>s(y).resetFields()),destroyOnClose:!0,"confirm-loading":s(x)},{default:e(()=>[a(ee,{ref_key:"formRef",ref:y,model:s(o),rules:M,"label-col":{style:{width:"100px"}}},{default:e(()=>[a(w,{label:"部门名称",name:"name","has-feedback":""},{default:e(()=>[a(F,{value:s(o).name,"onUpdate:value":t[0]||(t[0]=l=>s(o).name=l),placeholder:"请输入2-10个字符"},null,8,["value"])]),_:1}),a(w,{label:"部门编码",name:"code","has-feedback":""},{default:e(()=>[a(F,{value:s(o).code,"onUpdate:value":t[1]||(t[1]=l=>s(o).code=l),placeholder:"请输入2-10个字符"},null,8,["value"])]),_:1}),a(w,{label:"部门负责人",name:"managerId","has-feedback":""},{default:e(()=>[a(T,{value:s(o).managerId,"onUpdate:value":t[2]||(t[2]=l=>s(o).managerId=l),placeholder:"请选择负责人"},{default:e(()=>[(D(!0),N(S,null,de(s(P),l=>(D(),U(Z,{value:l.id},{default:e(()=>[u(I(l.username),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1}),a(w,{label:"部门介绍",name:"introduce","has-feedback":""},{default:e(()=>[a(K,{value:s(o).introduce,"onUpdate:value":t[3]||(t[3]=l=>s(o).introduce=l),placeholder:"1-100个字符","show-count":"",maxlength:100,rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title","confirm-loading"])],64)}}},Me=ne(Ne,[["__scopeId","data-v-addfb0a5"]]);export{Me as default};
